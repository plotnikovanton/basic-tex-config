% Author: Plotnikov Anton
% 2016
%
% Based on https://habrahabr.ru/post/144648/ article
%
% Simple latex preamble for Russian bachelor dissertation
% feel free to modify and use
%

% Set basic page parameters
\usepackage[left=3cm, right=1.5cm, vmargin=2.4cm]{geometry} % field
\linespread{1.3} % gost 1.5 interval
\setlength\parindent{5ex} % paragraph indentation

% Set header like gost
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[R]{\thepage}
\fancyheadoffset{0mm}
\fancyfootoffset{0mm}
\setlength{\headheight}{17pt}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
\fancypagestyle{plain}{
    \fancyhf{}
    \rhead{\thepage}}
\pagestyle{fancy}

% gost subfigures style
\usepackage[tableposition=top]{caption}
\usepackage{subcaption}
\DeclareCaptionLabelFormat{gostfigure}{Рисунок #2}
\DeclareCaptionLabelFormat{gosttable}{Таблица #2}
\DeclareCaptionLabelSeparator{gost}{~---~}
\captionsetup{labelsep=gost}
\captionsetup[figure]{labelformat=gostfigure}
\captionsetup[table]{labelformat=gosttable}
\renewcommand{\thesubfigure}{\asbuk{subfigure}}

% gost titles style
\usepackage{titlesec}
\titleformat{\chapter}[display]
    {\filcenter}
    {\MakeUppercase{\chaptertitlename} \thechapter}
    {8pt}
    {\bfseries}{}
\titleformat{\section}
    {\normalsize\bfseries}
    {\thesection}
    {1em}{}
\titleformat{\subsection}
    {\normalsize\bfseries}
    {\thesubsection}
    {1em}{}
\titlespacing*{\chapter}{0pt}{-30pt}{8pt}
\titlespacing*{\section}{\parindent}{*4}{*4}
\titlespacing*{\subsection}{\parindent}{*4}{*4}

% gost content page
\addto{\captionsrussian}{\renewcommand*{\contentsname}{Содержание}}
\usepackage{tocloft}
\renewcommand{\cfttoctitlefont}{\hspace{0.38\textwidth} \bfseries\MakeUppercase}
\renewcommand{\cftbeforetoctitleskip}{-1em}
\renewcommand{\cftaftertoctitle}{\mbox{}\hfill \\ \mbox{}\hfill{\footnotesize Стр.}\vspace{-2.5em}}
\renewcommand{\cftchapfont}{\normalsize\bfseries \MakeUppercase{\chaptername} }
\renewcommand{\cftsecfont}{\hspace{31pt}}
\renewcommand{\cftsubsecfont}{\hspace{11pt}}
\renewcommand{\cftbeforechapskip}{1em}
\renewcommand{\cftparskip}{-1mm}
\renewcommand{\cftdotsep}{1}
\setcounter{tocdepth}{2} % Only subsections in content page

% gost style for itemize
\renewcommand{\labelitemi}{-}
\renewcommand{\labelitemii}{-}
% gost style for enumerate
\renewcommand{\labelenumi}{\asbuk{enumi})}
\renewcommand{\labelenumii}{\arabic{enumii})}

% bibliography using bibtex and biber as backend
\usepackage[
    backend=biber,
    style=gost-numeric,
    %citestyle=gost-inline-min,
    sortlocale=ru_RU,
    natbib=true,
    url=false,
    %doi=true,
    %eprint=false,
    language=auto,
    autolang=langname
]{biblatex}
% Hack to prevent Error: langjapanese undefined.
\NewBibliographyString{langjapanese}
\NewBibliographyString{fromjapanese}

% new section type `likesection` for special sections, that should be in
% contents page, but should not be numerated
\newcommand{\empline}{\mbox{}\newline}
\newcommand{\likechapterheading}[1]{
    \begin{center}
    \textbf{\MakeUppercase{#1}}
    \end{center}
    \empline}
\makeatletter
    \renewcommand{\@dotsep}{2}
    \newcommand{\l@likechapter}[2]{{\bfseries\@dottedtocline{0}{0pt}{0pt}{#1}{#2}}}
\makeatother
\newcommand{\likechapter}[1]{
    \likechapterheading{#1}
    \addcontentsline{toc}{likechapter}{\MakeUppercase{#1}}}

